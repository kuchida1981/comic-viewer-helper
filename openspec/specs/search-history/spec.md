# Search History (検索履歴)

## Purpose
ユーザーが過去に入力した検索クエリを再利用できるようにし、検索の効率を向上させます。特に複数のタグを組み合わせた複雑なクエリの再入力を不要にすることで、目的の作品に素早くアクセスできる環境を提供します。

## Requirements

### Requirement: 検索履歴の記録と集約
システムは、検索が実行された際にそのクエリを履歴として記録しなければならない (SHALL)。ただし、意味的に同一のクエリ（順序違いの単語構成など）は重複とみなして最新の入力で集約し、最新順に最大3件まで保持しなければならない。

#### Scenario: 検索実行時の履歴記録
- **WHEN** ユーザーが新しいキーワードで検索を実行した時
- **THEN** そのキーワードが履歴の先頭に追加されること
- **AND** 履歴が最大件数（3件）を超える場合は、最も古い履歴が削除されること

#### Scenario: 重複クエリの集約
- **WHEN** ユーザーが既存の履歴と意味的に同一のクエリ（例：「a b」に対して「b a」）で検索を実行した時
- **THEN** 既存の履歴項目は削除され、最新の入力形式のクエリが履歴の先頭に配置されること

### Requirement: 検索履歴の永続化
システムは、検索履歴をホスト名ごとに `localStorage` に保存し、ページ再読み込み後も復元しなければならない (SHALL)。

#### Scenario: 履歴の永続化と復元
- **WHEN** 検索履歴が更新された時
- **THEN** `localStorage` に即座に保存されること
- **AND** ページリロード時に、そのホストに関連付けられた履歴が Store にロードされること
