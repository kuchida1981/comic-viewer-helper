# Site Adapter (サイトアダプター)

## Purpose
システムが特定のサイト構造（DOM、セレクタ、要素取得ロジック等）に依存しないように抽象化し、マルチサイト対応を容易にします。
## Requirements
### Requirement: サイトアダプターインターフェースの定義
システムは、特定のサイト構造に依存しないよう、サイトごとの差異（セレクタ、要素取得ロジック等）を吸収するための共通インターフェース（サイトアダプター）を定義しなければならない（SHALL）。

**アダプターが提供する機能:**
- URLに対する適合判定
- サイト固有のセレクタ/取得ロジック
- メタデータ抽出時のタグ種別判定
- **検索用URLの生成ロジック**

#### Scenario: サイト適合判定
- **WHEN** ページが読み込まれた時
- **THEN** 各アダプターが現在のURLに適合するかを判定し、適切なアダプターが選択されること

#### Scenario: サイト固有セレクタの提供
- **WHEN** アプリケーションが画像コンテナや画像要素を特定する必要がある時
- **THEN** 選択されたアダプターから提供されるサイト固有のセレクタが使用されること

#### Scenario: サイト固有の画像取得ロジック
- **WHEN** 標準的なセレクタのみでは画像取得が困難なサイトにおいて画像を取得する時
- **THEN** アダプターが提供する独自の取得ロジック（関数等）が実行されること

#### Scenario: タグ種別の判定
- **WHEN** アダプターがメタデータを抽出する時
- **THEN** 各タグの href を解析し、パスに基づいてタグ種別（type）を判定して返す
- **AND** タグオブジェクトには `type: string | null` プロパティが含まれる

#### Scenario: 検索URLの生成
- **WHEN** 検索キーワード（query）が与えられた時
- **THEN** アダプターはサイトの検索仕様に基づいたURLを生成して返さなければならない
- **AND** デフォルトアダプターでは `searchConfig`（baseUrl, queryParam）を使用してURLを生成する

### Requirement: 検索結果のHTMLパース
アダプターは、検索結果レスポンスのHTMLDocumentを受け取り、検索結果の一覧・件数・次ページURLを抽出して返すメソッドを提供しなければならない (SHALL)。
パースの対象とするDOM構造はサイトごとに異なるため、アダプターが定義する。

#### Scenario: 検索結果アイテムの抽出
- **WHEN** アダプターが検索結果レスポンスのHTMLDocumentを受け取った時
- **THEN** 各検索結果アイテムのコンテンツURL・サムネイルURL・タイトルが抽出され、`SearchResult[]` として返されること

#### Scenario: 件数の抽出
- **WHEN** アダプターが検索結果レスポンスのHTMLDocumentを受け取り、件数要素が存在する時
- **THEN** 件数テキスト（例: "64,786件"）が文字列として抽出され返されること

#### Scenario: 件数要素が存在しない場合
- **WHEN** アダプターが検索結果レスポンスのHTMLDocumentを受け取り、件数要素が存在しない時
- **THEN** 件数として `null` が返されること

#### Scenario: 次ページURLの抽出
- **WHEN** アダプターが検索結果レスポンスのHTMLDocumentを受け取り、次ページへのリンク要素が存在する時
- **THEN** 次ページURLが文字列として抽出され返されること

#### Scenario: 次ページリンクが存在しない場合
- **WHEN** アダプターが検索結果レスポンスのHTMLDocumentを受け取り、次ページへのリンク要素が存在しない時
- **THEN** 次ページURLとして `null` が返されること

### Requirement: 非公開作品へのフラグ付与
アダプターは、メタデータ抽出時の `relatedWorks` に対し、タイトルの先頭が「非公開」であるかを判定し、該当する作品に `isPrivate: true` を付与しなければならない (SHALL)。

#### Scenario: 非公開作品のフラグ付与
- **WHEN** アダプターが関連作品リストを抽出し、ある作品のタイトルが「非公開」で始まる
- **THEN** その作品オブジェクトに `isPrivate: true` が付与される

#### Scenario: 公開作品のフラグ付与
- **WHEN** アダプターが関連作品リストを抽出し、あるタイトルが「非公開」で始まらない
- **THEN** その作品オブジェクトに `isPrivate: false` が付与される

