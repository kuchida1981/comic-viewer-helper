# Search Interface (検索インターフェース)

## Purpose
ユーザーがサイト内のコンテンツを検索するためのUIを提供し、目的の作品へのアクセス性を向上させます。

## Requirements

### Requirement: 検索キーワード入力インターフェース
システムは、ユーザーが検索キーワードを入力し、検索を実行するためのモーダル形式のインターフェースを提供しなければならない (SHALL)。このインターフェースは、通信中の状態を適切にフィードバックし、背面のビューアーとのインタラクションを完全に分離しなければならない。また、過去の検索履歴を提示し、素早い再検索を支援しなければならない。また、特定のタグやジャンルによるフィルタリング検索時には、その条件が明確に示されなければならない。

#### Scenario: 検索モーダルの表示
- **WHEN** ツールバーの検索アイコンをクリックした時、またはキーボードの `/` キーを押下した時
- **THEN** 検索モーダルが表示され、入力フィールドに自動的にフォーカスが当たること

#### Scenario: キーワード入力による検索実行
- **WHEN** 入力フィールドにキーワードを入力し、Enterキーを押下または検索ボタンをクリックした時
- **THEN** 検索キーワードを `Store` に保存し、アダプターを通じて生成された検索URLに対して `fetch` を実行し、検索結果が表示されること
- **AND** 検索コンテキストが「キーワード検索」としてリセットされること

#### Scenario: タグ選択による検索実行（コンテキスト保持）
- **WHEN** メタデータモーダル等からタグが選択されて検索が実行された時
- **THEN** 検索モーダルが表示され、入力フィールドには何もセットされず（またはオプションでタグ名がセットされ）、検索結果が表示されること
- **AND** 検索結果ヘッダーに、選択されたタグの名前が「検索コンテキスト」として表示されること

#### Scenario: 検索結果が0件の場合
- **WHEN** キーワード入力による検索実行の結果、検索結果が0件であった時
- **THEN** 結果が見つからないことを示すメッセージがモーダル内で表示されること

#### Scenario: モーダルの閉鎖
- **WHEN** 閉じるボタンをクリック、またはモーダル外（オーバーレイ）をクリックした時
- **THEN** 検索モーダルが閉じるが、`Store` 内の検索結果およびキーワードは維持されること

#### Scenario: 検索・ページング実行中のフィードバック
- **WHEN** 検索の実行中、またはページングボタンによるデータ取得中である時
- **THEN** 検索結果エリアにローディングインジケータ（オーバーレイとスピナー）が表示されること
- **AND** 検索入力フィールドおよび送信ボタンが無効化（disabled）されること

#### Scenario: モーダル内イベントの絶縁
- **WHEN** 検索モーダル内の任意の場所をクリック、またはフォームを送信した時
- **THEN** そのイベントは背面のメインビュー（画像ビューアー）に伝搬せず、意図しないページ移動やスクロールが発生しないこと

#### Scenario: 検索履歴からの再検索
- **WHEN** 検索履歴として表示されているキーワードをクリックした時
- **THEN** そのキーワードが入力フィールドにセットされ、即座に検索が実行されること

### Requirement: 検索状態の自動復元
システムは、検索モーダルを開いた際、前回の検索キーワードが存在すればそれを入力フィールドに復元し、検索結果が存在すればそれを即座に表示しなければならない (SHALL)。

#### Scenario: モーダル再開時の状態復元
- **WHEN** 検索モーダルを開いた時
- **THEN** 前回のキーワードが入力フィールドにセットされ、前回の検索結果が表示されること