## Context

現在、プロジェクトは単一の `comic-viewer-helper.user.js` ファイルで構成されており、自動テストが存在しません。Issue #9 では、品質向上のためにユニットテストの導入と GitHub Actions による CI 自動化が求められています。

## Goals / Non-Goals

**Goals:**
- ユニットテストフレームワークの導入。
- コアロジック（画像計算、ページ処理など）のテストコード作成。
- GitHub Actions を用いた CI 環境（プッシュ/PR時の自動テスト）の構築。
- 開発者が簡単にテストを追加・実行できる仕組みの提供。

**Non-Goals:**
- E2Eテスト（ブラウザ上での実動作テスト）の導入。
- 既存コードの大規模なリファクタリング（テストを容易にするための最小限の変更は含む）。

## Decisions

### 1. テストフレームワークの選定: Vitest
- **理由**:
  - Vite エコシステムの一部であり、高速で設定が容易。
  - Jest と互換性のある API を持ちつつ、ネイティブの ESM サポートが強力。
  - プロジェクトが将来的に Vite を導入する場合にも親和性が高い。
- **代替案**:
  - Jest: 広く使われているが、ESM の設定が Vitest ほど直感的ではない場合がある。

### 2. コード構造の変更: モジュール化
- **理由**:
  - 現状の `user.js` は巨大な単一ファイルであるため、そのままでは各関数を個別にインポートしてテストすることが困難。
  - テスト対象の関数を `export` するか、内部ロジックを分離してインポート可能な形式にする必要がある。
- **方針**: `comic-viewer-helper.user.js` からロジックを分離するか、JSDoc を利用してテスト環境のみ `export` を有効にする等の手法を検討する。

### 3. CI環境: GitHub Actions
- **理由**:
  - リポジトリが GitHub にあり、統合が最もスムーズ。
  - 既に `.github/workflows/lint.yml` が存在するため、既存のパターンに合わせることができる。

## Risks / Trade-offs

- **[Risk]**: `user.js` 特有のグローバル変数（`unsafeWindow`, `GM_xmlhttpRequest` 等）がテスト環境で未定義になる。
  - **Mitigation**: Vitest の `globals` 設定や、モック（Mocking）ライブラリを使用してこれらをシミュレートする。
- **[Risk]**: 既存の単一ファイル構造がテストを阻害する。
  - **Mitigation**: ロジック部分を抽出してテストしやすくするための最小限のコード分割を行う。
