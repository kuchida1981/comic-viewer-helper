## Context

現在のコードベースは JSDoc を用いた JavaScript で記述されており、`tsc` による型チェックが行われています。ビルドは `scripts/build.mjs` を通じて Vite で実行され、最終的に UserScript のヘッダー（`src/header.js`）と結合されます。TypeScript への完全移行により、型の再定義（JSDoc と `global.d.ts` の重複）を解消し、より強固な開発基盤を構築します。

## Goals / Non-Goals

**Goals:**
- `src/` 以下のすべてのコード（テストを含む）を `.ts` に移行する。
- 実行時の挙動（UserScript としての機能）を完全に維持する。
- ESLint を TypeScript 対応にし、型安全な開発フローを確立する。
- ビルドプロセスを `.ts` ファイルに対応させる。

**Non-Goals:**
- 機能の追加や既存バグの修正（リファクタリングに専念する）。
- 大規模なアーキテクチャの変更（型定義の整理に留める）。

## Decisions

### 1. 段階的な移行戦略
一括変換ではなく、以下の順序で段階的に移行します。
- **Rationale**: 依存関係の下流から進めることで、型定義の不整合を最小限に抑え、各段階でビルドとテストの整合性を確認できるため。
- **Alternatives**: 一括変換。コードベースが比較的小さいため可能ではあるが、ビルドスクリプトの調整などインフラ面の変更を同時に行う必要があるため、リスク分散を選択。

### 2. `src/header.js` の扱い
`src/header.ts` に変更し、中身はコメントブロックのみを維持します。
- **Rationale**: プロジェクト内の拡張子を統一し、エディタの支援を最大限に受けるため。ビルドスクリプトで `.ts` ファイルとして読み込むよう修正します。
- **Alternatives**: `.js` のまま残す、または `.txt` にする。統一感を損なうため不採用。

### 3. インポート時の拡張子
`import ... from './file.js'` の形式を維持、または拡張子なしに移行します。
- **Rationale**: Vite と Vitest の設定により、拡張子なしでも適切に解決可能です。TypeScript 5.x の ESM 互換性を考慮し、最終的な出力に影響しない範囲で調整します。

### 4. ESLint の刷新
`typescript-eslint` を導入し、JSDoc ベースのルールから TS 本来のルールに移行します。
- **Rationale**: JSDoc では検知できなかった型の不整合を静的にキャッチするため。

## Risks / Trade-offs

- **[Risk] ビルド後の結合不備** → **[Mitigation]** `scripts/build.mjs` の修正後、生成された `dist/*.user.js` の中身を手動およびテストで厳密に確認する。
- **[Risk] 型定義の競合** → **[Mitigation]** `src/global.d.ts` を整理し、各モジュールで定義をエクスポート/インポートする形式に統一する。
- **[Trade-off] 移行コスト** → 型の厳格化により、これまで許容されていた曖昧なコードの修正が必要になる可能性があるが、長期的な保守性のために受け入れる。
