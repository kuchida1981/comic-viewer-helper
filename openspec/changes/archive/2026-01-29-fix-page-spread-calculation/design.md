## Context

現在の実装では、`toggleDualView` 関数にて `fitImagesToViewport(currentIndex)` を呼び出し、現在表示中のページを見開きの開始（右側）にする意図のロジックが存在しています。しかし、ユーザー報告によると意図通りに動作せず、表示中のページが見開きの左側（ペアの2枚目）になってしまうケースがあります。

## Goals / Non-Goals

**Goals:**
- 単一ページ表示から見開き表示への切り替え時に、現在フォーカスされているページが確実に見開きペアの右側（1枚目）に来るように修正する。
- 既存の「アライメントインデックス」ロジック（`fitImagesToViewport` の `alignmentIndex` 引数）が正しく機能しているか検証し、必要であれば修正する。
- `getCurrentPageIndex` の判定ロジックがユーザーの体感と一致しているか確認する。

**Non-Goals:**
- 見開き表示から単一ページ表示への切り替えロジックの変更。
- 画像のリサイズやレイアウト自体のCSS変更（ペアリングの決定ロジックのみに注力）。

## Decisions

### 1. `fitImagesToViewport` のロジック修正
現在の実装では、`nextIsAlignmentTarget` の判定により、ターゲットの「一つ前の画像」を強制的に単独表示にすることで、ターゲット画像から新しいペアを開始させようとしています。
このロジック自体は妥当ですが、実際のループ処理や条件分岐において、意図しないペアリングが発生していないか再確認します。特に、連続する画像処理の流れの中で「単独表示」となった画像がスタイルリセットされる処理などが正しく行われているかを確認します。

### 2. `getCurrentPageIndex` の精度確認
ページインデックスの取得には `getCurrentPageIndex` が使用されています。これはビューポートの中心にある画像を「現在のページ」と判定します。
切り替え時にユーザーが見ているページが確実に取得されるよう、この判定ロジックは維持しつつ、デバッグログ等で取得値が正しいか確認しながら実装を進めます。

### 3. 強制アライメントの優先度
`alignmentIndex` が指定された場合、そのインデックスの画像は**絶対に**ペアの左側（2枚目）になってはいけません。
現在の `nextIsAlignmentTarget` チェックは「ペアの左側になるのを防ぐ」ためのものですが、より直接的に「ターゲット画像処理時に必ず新しいペアを開始する（または単独なら右側に置く）」ような制御フローになっているか確認します。

## Risks / Trade-offs

**Risks:**
- 強制的にペアを切ることで、それ以前の画像の並びが不自然になる（例：本来ペアになるべき前の2枚がずれる）可能性がありますが、切り替え直後のユーザー体験としては「見ているページ」の維持が最優先であるため許容します。
- 切り替え後、スクロールして戻った場合のペアリングが以前と異なる（リセットされる）可能性がありますが、これも仕様として許容します。
