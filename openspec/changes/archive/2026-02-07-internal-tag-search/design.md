## Context

現在のコミックビューアにはメタデータ表示機能（タイトル、タグ、関連作品）と内部検索機能がありますが、これらは独立しています。メタデータモーダル内のタグをクリックするとブラウザの通常動作により外部サイトへ遷移してしまい、ビューアの利便性が損なわれています。
本デザインでは、タグのクリックをフックし、拡張機能内の検索モーダルでそのタグの結果を表示する統合フローを定義します。

## Goals / Non-Goals

**Goals:**
- メタデータモーダルのタグクリック時に、ビューアを離れることなく内部検索を実行する。
- 検索結果画面で、現在「キーワード」で検索しているのか「特定のタグ/ジャンル」で検索しているのかを明示する。
- 検索履歴やキャッシュの仕組みを、タグ検索とキーワード検索で整合性を保ちながら拡張する。

**Non-Goals:**
- 検索結果の表示形式（グリッド）自体の抜本的な変更。
- メタデータモーダル以外（外部サイトのリンク等）からの検索フック。

## Decisions

### 1. StoreState への `searchContext` 追加
検索がどのような意図（キーワード vs タグ）で実行されたかを保持するため、`searchContext` フィールドを追加します。
```typescript
export interface SearchContext {
  type: 'keyword' | 'tag' | 'genre' | 'artist';
  label?: string; // 表示用の名前（例: "アクション"）
}
```
これにより、`SearchModal` は `searchQuery`（生のクエリ/URL）に依存せず、ユーザーに分かりやすいヘッダーを表示できます。

### 2. `MetadataModal` へのコールバック追加
`MetadataModal` はUIコンポーネントとしての責務に専念させるため、タグクリック時の処理を `onTagClick` コールバックとして外部から注入します。
- `onTagClick: (tag: Tag) => void`
これにより、`UIManager` 側で検索ロジックを一括管理できます。

### 3. `UIManager._performSearch` の拡張
既存の `_performSearch` は `queryOrUrl` を受け取りますが、これを拡張して明示的なコンテキスト（type, label）を指定可能にします。
- URLが渡された場合、アダプターの `getSearchUrl` を通さず直接そのURLをフェッチします。
- タグ検索の場合、`searchHistory` には追加しないようにします（履歴はユーザーが手入力したキーワードのみに限定するため）。

### 4. キャッシュキーの扱い
現在のキャッシュは `query` をキーとしていますが、URLをキーに含める、あるいは `searchContext` を含めた複合的な管理を行うことで、キーワード検索とタグ検索の結果が混ざることを防ぎます。

## Risks / Trade-offs

- **[Risk] キャッシュの肥大化** → タグごとにキャッシュを持つと localStorage の上限に達する可能性がある。
  - **Mitigation**: 検索キャッシュのTTL（1時間）を厳守し、不要な古いキャッシュを積極的にパージするロジックを検討する。
- **[Risk] URLパターンの不一致** → アダプターが想定していないURL形式のタグがある場合、検索結果のパースに失敗する可能性がある。
  - **Mitigation**: 検索結果のパースに失敗した場合はエラーを表示し、フォールバックとして外部サイトへのリンクを有効にする（あるいはユーザーに通知する）。
